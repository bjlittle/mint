program test
    ! defines the C API
    use mnt_regridedges_capi_mod

    use, intrinsic :: iso_c_binding, only: c_size_t, c_int, c_double, c_ptr

    implicit none
    type(c_ptr)                  :: crg
    character(len=256)           :: src_filename, dst_filename, output_filename
    integer                      :: num_cells_per_bucket, ier

    ier = mnt_regridedges_new(crg)
    if(ier /= 0) print*,'ERROR after new ier = ', ier

    src_filename = "@CMAKE_SOURCE_DIR@/data/cs_16.nc"
    ier = mnt_regridedges_loadsrc(crg, src_filename, len_trim(src_filename))
    if(ier /= 0) print*,'ERROR after loadsrc ier = ', ier

    dst_filename = "@CMAKE_SOURCE_DIR@/data/cs_4.nc"
    ier = mnt_regridedges_loaddst(crg, dst_filename, len_trim(dst_filename))
    if(ier /= 0) print*,'ERROR after loaddst ier = ', ier

    num_cells_per_bucket = 8
    ier = mnt_regridedges_build(crg, num_cells_per_bucket)
    if(ier /= 0) print*,'ERROR ier = after build', ier
    
    ier = mnt_regridedges_dump(crg, output_filename, len_trim(output_filename))
    if(ier /= 0) print*,'ERROR ier = after dump', ier

    ier = mnt_regridedges_del(crg)
    if(ier /= 0) print*,'ERROR after del ier = ', ier

end program test
