from mint import RegridEdges
import numpy


def test_compute_weights():

    rg = RegridEdges()

    # src is lon-lat grid
    rg.setSrcGridFlags(0, 0)
    rg.loadSrcGrid('@CMAKE_SOURCE_DIR@/data/latlon4x2.nc:latlon')

    # dst is cubed-sphere
    rg.setSrcGridFlags(1, 1)
    rg.loadDstGrid('@CMAKE_SOURCE_DIR@/data/cs_4.nc:physics')

    rg.build(128, 360., debug=2)

    rg.dumpWeights('test_regrid_edges_py.nc')


def test_apply_weights():
    
    rg = RegridEdges()

    # src is lon-lat grid
    rg.setSrcGridFlags(0, 0)
    rg.loadSrcGrid('@CMAKE_SOURCE_DIR@/data/latlon4x2.nc:latlon')

    # dst is cubed-sphere
    rg.setSrcGridFlags(1, 1)
    rg.loadDstGrid('@CMAKE_SOURCE_DIR@/data/cs_4.nc:physics')

    rg.loadWeights('test_regrid_edges_py.nc')

    num_src_edges = rg.getNumSrcEdges()
    num_dst_edges = rg.getNumDstEdges()

    src_data = numpy.array(range(0, num_src_edges), numpy.float64)
    dst_data = numpy.empty((num_dst_edges,), numpy.float64)

    rg.apply(src_data, dst_data)
    print(f'dst_data = {dst_data}')


if __name__ == '__main__':
    test_compute_weights()
    test_apply_weights()


